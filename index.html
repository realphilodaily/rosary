<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Prayer TV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400&display=swap');
        
        body { font-family: 'Lato', sans-serif; }
        h1, h2, h3 { font-family: 'Cinzel', serif; }

        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            background-color: black;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Minimal Overlay for Unmute */
        .control-layer {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 30;
        }

        /* Waiting Screen */
        .waiting-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(10, 10, 10, 0.95);
            z-index: 40;
            color: white;
            text-align: center;
        }

        .hidden { display: none !important; }

        .pulsing-dot {
            width: 8px;
            height: 8px;
            background-color: #ef4444;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen flex flex-col items-center justify-center p-4">

    <header class="text-center mb-6">
        <h1 class="text-2xl md:text-4xl text-amber-100">Daily Rosary by RealPhilo.com</h1>
        <div class="flex justify-center items-center gap-4 text-xs md:text-sm text-slate-500 mt-2">
            <span id="current-day" class="text-amber-500 font-bold uppercase">Today</span>
            <span>â€¢</span>
            <span id="clock" class="font-mono">--:--</span>
        </div>
    </header>

    <main class="w-full max-w-5xl bg-black rounded-xl overflow-hidden shadow-2xl border border-slate-800 relative">
        
        <div class="video-container group">
            
            <!-- VIDEO PLAYER -->
            <!-- We removed the <source> tag here because we inject it via JavaScript based on the day -->
            <video id="prayer-video" playsinline preload="auto" muted>
                Your browser does not support the video tag.
            </video>

            <!-- UNMUTE BUTTON (Appears if video is playing muted) -->
            <div id="unmute-controls" class="control-layer hidden">
                <button id="unmute-btn" class="bg-black/60 hover:bg-amber-700/90 text-white backdrop-blur-md px-4 py-2 rounded-full flex items-center gap-2 transition-all border border-white/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    Tap to Unmute
                </button>
            </div>

            <!-- WAITING SCREEN -->
            <div id="waiting-screen" class="waiting-screen hidden">
                <h3 class="text-xl text-slate-400 font-light mb-4">Prayer Concluded</h3>
                <div class="text-4xl font-mono font-bold text-amber-500" id="countdown">00:00</div>
                <p class="text-xs text-slate-500 mt-2 uppercase tracking-widest">Next service starts soon</p>
            </div>

        </div>

    </main>

    <div id="status-debug" class="mt-4 text-xs text-slate-600 font-mono">Initializing...</div>

    <script>
        // ==========================================
        // CONFIGURATION: SETUP YOUR VIDEOS HERE
        // ==========================================
        
        // You can use the SAME link for every day, or different ones.
        // Use your VIMEO PAID MP4 links here.
        const DAILY_VIDEOS = {
            "Sunday":    "https://player.vimeo.com/progressive_redirect/playback/1147755063/rendition/720p/file.mp4%20%28720p%29.mp4?loc=external&signature=baf4a57baf17ee5e5a6298c3ae2d103ffacdf549115c8e77d142d23ee26732b2",
            "Monday":    "https://player.vimeo.com/progressive_redirect/playback/1147755063/rendition/720p/file.mp4%20%28720p%29.mp4?loc=external&signature=baf4a57baf17ee5e5a6298c3ae2d103ffacdf549115c8e77d142d23ee26732b2",
            "Tuesday":   "https://player.vimeo.com/progressive_redirect/playback/1147755063/rendition/720p/file.mp4%20%28720p%29.mp4?loc=external&signature=baf4a57baf17ee5e5a6298c3ae2d103ffacdf549115c8e77d142d23ee26732b2",
            "Wednesday": "https://player.vimeo.com/progressive_redirect/playback/1147755063/rendition/720p/file.mp4%20%28720p%29.mp4?loc=external&signature=baf4a57baf17ee5e5a6298c3ae2d103ffacdf549115c8e77d142d23ee26732b2",
            "Thursday":  "https://player.vimeo.com/progressive_redirect/playback/1147899272/rendition/1080p/file.mp4%20%281080p%29.mp4?loc=external&signature=67a9cab62296d2115180264cdd9f270aad1805c9a4473e1cb53a8597e44ffedc",
            "Friday":    "https://player.vimeo.com/progressive_redirect/playback/1147908556/rendition/1080p/file.mp4%20%281080p%29.mp4?loc=external&signature=92b25ac1b4e5f8da0ed5319a709f88c0871bab061dfc64408e05705df98daeb1",
            "Saturday":  "https://player.vimeo.com/progressive_redirect/playback/1147755063/rendition/720p/file.mp4%20%28720p%29.mp4?loc=external&signature=baf4a57baf17ee5e5a6298c3ae2d103ffacdf549115c8e77d142d23ee26732b2"
        };

        // ==========================================
        // SYSTEM CODE
        // ==========================================

        const video = document.getElementById('prayer-video');
        const waitingScreen = document.getElementById('waiting-screen');
        const unmuteBtn = document.getElementById('unmute-btn');
        const unmuteControls = document.getElementById('unmute-controls');
        const countdownEl = document.getElementById('countdown');
        const debugEl = document.getElementById('status-debug');
        const currentDayEl = document.getElementById('current-day');
        const clockEl = document.getElementById('clock');

        // Setup Day and Video Source
        const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const today = days[new Date().getDay()];
        currentDayEl.innerText = today;
        video.src = DAILY_VIDEOS[today];

        let hasSyncedInitialTime = false;

        // --- THE ENGINE ---

        function checkSchedule() {
            const now = new Date();
            const totalSecondsInHour = (now.getMinutes() * 60) + now.getSeconds();
            const cycleLength = 1800; // 30 Minutes
            
            // Calculate where we are in the 30-min block
            const secondsIntoCycle = totalSecondsInHour % cycleLength;
            
            // Update Clock
            clockEl.innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            // Wait for metadata to know video length
            if (isNaN(video.duration)) {
                debugEl.innerText = "Loading Video Metadata...";
                return;
            }

            // Are we LIVE? (Time is less than video duration)
            if (secondsIntoCycle < video.duration) {
                // HIDE waiting screen
                waitingScreen.classList.add('hidden');
                
                // === AGGRESSIVE SYNC LOGIC ===
                
                // 1. If paused, try to Autoplay (Muted)
                if (video.paused) {
                    video.muted = true; // Crucial for autoplay
                    video.play().then(() => {
                        debugEl.innerText = "Autoplaying Muted...";
                        // Once playing, Show Unmute Button
                        unmuteControls.classList.remove('hidden');
                    }).catch(e => {
                        debugEl.innerText = "Autoplay Blocked (Tap screen)";
                    });
                }

                // 2. FORCE TIME SYNC (The Fix for the "Start at 0" bug)
                const drift = Math.abs(video.currentTime - secondsIntoCycle);
                
                // If we are more than 2 seconds off, JUMP.
                if (drift > 2) {
                    console.log(`Sync Jump: ${video.currentTime} -> ${secondsIntoCycle}`);
                    video.currentTime = secondsIntoCycle;
                }

                debugEl.innerText = `Live | Offset: ${Math.floor(secondsIntoCycle)}s`;

            } else {
                // === WAITING MODE ===
                waitingScreen.classList.remove('hidden');
                unmuteControls.classList.add('hidden');
                
                if (!video.paused) {
                    video.pause();
                }

                // Countdown Logic
                const secondsRemaining = cycleLength - secondsIntoCycle;
                const m = Math.floor(secondsRemaining / 60);
                const s = Math.floor(secondsRemaining % 60);
                countdownEl.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                
                debugEl.innerText = "Waiting for next cycle";
            }
        }

        // --- UNMUTE INTERACTION ---
        unmuteBtn.addEventListener('click', () => {
            video.muted = false;
            // When we unmute, we hide the button so it looks clean
            unmuteControls.classList.add('hidden');
        });

        // --- INITIALIZATION ---
        
        // Run check immediately, then every 1 second
        video.addEventListener('loadedmetadata', checkSchedule);
        setInterval(checkSchedule, 1000);
        
        // Also force a check on page load just in case
        checkSchedule();

    </script>
</body>
</html>
